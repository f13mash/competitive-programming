<html><head><title>WolfDelaymasterHard</title></head><body  ><table><tr><td colspan="2"><h3>Problem Statement</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td>Wolf Sothe is playing the game Delaymaster.
In this game, he can create new words according to the following rules:
<ol>
<li>For each positive integer n, the string which consists of n copies of 'w' followed by n copies of 'o' is a valid word.</li>
<li>The concatenation of two valid words is a valid word.</li>
<li>Only the words that can be obtained by rules 1 and 2 are valid. There are no other valid words.</li>
</ol>
Thus, for example:
<ul>
<li>By rule 1, "wo", "wwoo", and "wwwwwooooo" are valid words.</li>
<li>Then, by rule 2, "wowwoo" is a valid word.</li>
<li>By applying rule 2 twice, "wowwoowo" is a valid word.</li>
<li>The strings "w", "ow", "woow", and "wwwoo" are not valid words.</li>
</ul>
Sothe has a very long string s.
Each character of s is one of 'w', 'o', and '?'.
Sothe wants to replace each '?' with either 'w' or 'o' in such a way that the result is a valid word.
Return the number of different valid words he can obtain this way, modulo 1,000,000,007.
<br></br>
<br></br>
As s can be very long, you will have to generate it in your program.
You are given nine ints: <b>N</b>, <b>wlen</b>, <b>w0</b>, <b>wmul</b>, <b>wadd</b>, <b>olen</b>, <b>o0</b>, <b>omul</b>, and <b>oadd</b>.
Use the following pseudocode to generate s:

<br></br>
<br></br>

<pre>
s = "???...???";				// Concatenation of <b>N</b> '?'s

signed_64bit_integer x = <b>w0</b>;
for(i=0;i&lt;<b>wlen</b>;i++){
	s[x] = 'w';				// Rewrite the x-th (0-based) character of s
	x = (x * <b>wmul</b> + <b>wadd</b>) % <b>N</b>;
}

x = <b>o0</b>;
for(i=0;i&lt;<b>olen</b>;i++){
	s[x] = 'o';				// Rewrite the x-th (0-based) character of s
	x = (x * <b>omul</b> + <b>oadd</b>) % <b>N</b>;
}
</pre></td></tr><tr><td colspan="2"><h3>Definition</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Class:</td><td>WolfDelaymasterHard</td></tr><tr><td>Method:</td><td>countWords</td></tr><tr><td>Parameters:</td><td>int, int, int, int, int, int, int, int, int</td></tr><tr><td>Returns:</td><td>int</td></tr><tr><td>Method signature:</td><td>int countWords(int N, int wlen, int w0, int wmul, int wadd, int olen, int o0, int omul, int oadd)</td></tr><tr><td colspan="2">(be sure your method is public)</td></tr></table></td></tr><tr><td>&#160;&#160;&#160;&#160;</td></tr><tr><td></td></tr><tr><td colspan="2"><h3>Constraints</h3></td></tr><tr><td align="center" valign="top">-</td><td><b>N</b> will be an even number between 2 and 2,000,000, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>wlen</b> and <b>olen</b> will be between 0 and <b>N</b>, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>w0</b>, <b>wmul</b>, <b>wadd</b>, <b>o0</b>, <b>omul</b>, and <b>oadd</b> will be between 0 and <b>N</b> - 1, inclusive.</td></tr><tr><td colspan="2"><h3>Examples</h3></td></tr><tr><td align="center" nowrap="true">0)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>8</pre></td></tr><tr><td><pre>5</pre></td></tr><tr><td><pre>2</pre></td></tr><tr><td><pre>3</pre></td></tr><tr><td><pre>2</pre></td></tr><tr><td><pre>0</pre></td></tr><tr><td><pre>6</pre></td></tr><tr><td><pre>7</pre></td></tr><tr><td><pre>1</pre></td></tr></table></td></tr><tr><td><pre>Returns: 6</pre></td></tr><tr><td><table><tr><td colspan="2">s is "w?w?????". He can obtain six valid words: "wwwwoooo", "wwwooowo", "wowwwooo", "wowwoowo", "wowowwoo", and "wowowowo".</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">1)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>20</pre></td></tr><tr><td><pre>19</pre></td></tr><tr><td><pre>12</pre></td></tr><tr><td><pre>9</pre></td></tr><tr><td><pre>15</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>8</pre></td></tr><tr><td><pre>11</pre></td></tr><tr><td><pre>1</pre></td></tr></table></td></tr><tr><td><pre>Returns: 26</pre></td></tr><tr><td><table><tr><td colspan="2">s is "??ww????o???ww??????".</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">2)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>40</pre></td></tr><tr><td><pre>24</pre></td></tr><tr><td><pre>34</pre></td></tr><tr><td><pre>5</pre></td></tr><tr><td><pre>11</pre></td></tr><tr><td><pre>33</pre></td></tr><tr><td><pre>35</pre></td></tr><tr><td><pre>23</pre></td></tr><tr><td><pre>27</pre></td></tr></table></td></tr><tr><td><pre>Returns: 296</pre></td></tr><tr><td><table><tr><td colspan="2">s is "?w?o??w????w????o????w????w????wo?wow???".</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">3)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>60</pre></td></tr><tr><td><pre>35</pre></td></tr><tr><td><pre>8</pre></td></tr><tr><td><pre>55</pre></td></tr><tr><td><pre>3</pre></td></tr><tr><td><pre>11</pre></td></tr><tr><td><pre>20</pre></td></tr><tr><td><pre>9</pre></td></tr><tr><td><pre>29</pre></td></tr></table></td></tr><tr><td><pre>Returns: 10058904</pre></td></tr><tr><td><table><tr><td colspan="2">s is "????????w???????????o??w?????o????????????????????o????????o".</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">4)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>2000</pre></td></tr><tr><td><pre>183</pre></td></tr><tr><td><pre>994</pre></td></tr><tr><td><pre>862</pre></td></tr><tr><td><pre>468</pre></td></tr><tr><td><pre>148</pre></td></tr><tr><td><pre>433</pre></td></tr><tr><td><pre>1247</pre></td></tr><tr><td><pre>1989</pre></td></tr></table></td></tr><tr><td><pre>Returns: 532199331</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">5)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>2000000</pre></td></tr><tr><td><pre>419443</pre></td></tr><tr><td><pre>1305303</pre></td></tr><tr><td><pre>1761823</pre></td></tr><tr><td><pre>1007025</pre></td></tr><tr><td><pre>874640</pre></td></tr><tr><td><pre>1516339</pre></td></tr><tr><td><pre>229519</pre></td></tr><tr><td><pre>1473199</pre></td></tr></table></td></tr><tr><td><pre>Returns: 861766906</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">6)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>8</pre></td></tr><tr><td><pre>6</pre></td></tr><tr><td><pre>0</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>3</pre></td></tr><tr><td><pre>3</pre></td></tr><tr><td><pre>6</pre></td></tr><tr><td><pre>1</pre></td></tr></table></td></tr><tr><td><pre>Returns: 0</pre></td></tr><tr><td><table><tr><td colspan="2">s is "wwwoww??". He can't obtain any valid words.</td></tr></table></td></tr></table></td></tr></table><p>This problem statement is the exclusive and proprietary property of TopCoder, Inc.  Any unauthorized use or reproduction of this information without the prior written consent of TopCoder, Inc. is strictly prohibited.  (c)2003, TopCoder, Inc.  All rights reserved.  </p></body></html>